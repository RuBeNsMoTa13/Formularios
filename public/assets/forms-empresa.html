<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="/assets/styles/style.css" />
  <link rel="stylesheet" href="/assets/styles/forms.css" />

  <title>Formulário de Informações Empresariais</title>
</head>

<body>
  <!-- Header Section -->
  <script src="/assets/scripts/header.js"></script>

  <!-- Main Content -->
  <main>
    <div id="alert" class="alert hidden"></div>
    <form id="businessForm" class="form-bordered">
      <h1>Formulário de Informações Empresariais</h1>

      <div>
        <label for="empresa">Nome da empresa/projeto</label>
        <div class="input-container">
          <input type="text" id="empresa" name="empresa" class="neon" maxlength="200" />
          <span class="char-counter" id="empresa-counter">0/200</span>
        </div>
      </div>

      <div>
        <label for="setor">Setor ou Indústria</label>
        <div class="input-container">
          <input type="text" id="setor" name="setor" class="neon" maxlength="200" />
          <span class="char-counter" id="setor-counter">0/200</span>
        </div>
      </div>

      <div>
        <label for="nicho">Nicho de mercado</label>
        <div class="input-container">
          <input type="text" id="nicho" name="nicho" class="neon" maxlength="200" />
          <span class="char-counter" id="nicho-counter">0/200</span>
        </div>
        <div>Exemplo: moda, tecnologia, educação, saúde</div>
      </div>

      <div>
        <label for="departamento">Departamento</label>
        <div class="input-container">
          <input type="text" id="departamento" name="departamento" class="neon" maxlength="200" />
          <span class="char-counter" id="departamento-counter">0/200</span>
        </div>
      </div>

      <div>
        <label for="localizacao">Localização geográfica do mercado de atuação</label>
        <div class="input-container">
          <input type="text" id="localizacao" name="localizacao" class="neon" maxlength="200" />
          <span class="char-counter" id="localizacao-counter">0/200</span>
        </div>
        <div>
          Exemplo: Municipal - São Paulo/SP /ou/ Estadual - São Paulo e Minas
          Gerais /ou/ América Latina /ou/ Global
        </div>
      </div>

      <div>
        <label for="marca">Nome da Marca</label>
        <div class="input-container">
          <input type="text" id="marca" name="marca" class="neon" maxlength="200" />
          <span class="char-counter" id="marca-counter">0/200</span>
        </div>
      </div>

      <div>
        <label for="slogan">Slogan (se houver)</label>
        <div class="input-container">
          <input type="text" id="slogan" name="slogan" class="neon" maxlength="200" />
          <span class="char-counter" id="slogan-counter">0/200</span>
        </div>
      </div>

      <div>
        <label for="fundadores">Fundador(es)</label>
        <div class="input-container">
          <input type="text" id="fundadores" name="fundadores" class="neon" maxlength="200" />
          <span class="char-counter" id="fundadores-counter">0/200</span>
        </div>
      </div>

      <div>
        <label for="fundacao">Ano de fundação</label>
        <div class="input-container">
          <input type="text" id="fundacao" name="fundacao" class="neon" maxlength="50" />
          <span class="char-counter" id="fundacao-counter">0/50</span>
        </div>
        <div>Exemplo: Março de 2010</div>
      </div>

      <div>
        <label>Seu negócio está em qual estágio hoje?</label>
        <div>
          <input type="radio" id="inicial" name="estagio" value="inicial" class="neon" />
          <label for="inicial">Inicial</label>
          <input type="radio" id="crescimento" name="estagio" value="crescimento" class="neon" />
          <label for="crescimento">Crescimento</label>
          <input type="radio" id="escala" name="estagio" value="escala" class="neon" />
          <label for="escala">Escala</label>
        </div>
      </div>

      <div>
        <label for="sede">Localização da Sede se aplicável</label>
        <div class="input-container">
          <input type="text" id="sede" name="sede" class="neon" maxlength="200" />
          <span class="char-counter" id="sede-counter">0/200</span>
        </div>
        <div>Exemplo: Matriz - São Paulo/SP</div>
      </div>

      <div>
        <label for="site">Site</label>
        <div class="input-container">
          <input type="url" id="site" name="site" class="neon" maxlength="100" />
          <span class="char-counter" id="site-counter">0/100</span>
        </div>
      </div>

      <div>
        <label for="redes">Redes Sociais</label>
        <div class="input-container">
          <input type="text" id="redes" name="redes" class="neon" maxlength="200" />
          <span class="char-counter" id="redes-counter">0/200</span>
        </div>
        <div>Exemplo: Instagram, Facebook, Linkedin, TikTok, Youtube </div>
      </div>

      <div></div>
        <label>Sua marca possui um logotipo?</label>
        <div>
          <input type="radio" id="tem_logotipo_sim" name="tem_logotipo" value="sim" required />
          <label for="tem_logotipo_sim">Sim</label>
          <input type="radio" id="tem_logotipo_nao" name="tem_logotipo" value="nao" />
          <label for="tem_logotipo_nao">Não</label>
        </div>
      </div>

      <div id="logotipo_upload" style="display: none;">
        <label for="logotipo">Faça o upload do logotipo:</label>
        <input type="file" id="logotipo" name="logotipo" accept="image/*" />
      </div>

      <div>
        <label for="cores">Quais cores representam sua marca?</label>
        <div class="input-container">
          <input type="text" id="cores" name="cores" class="neon" maxlength="200" />
          <span class="char-counter" id="cores-counter">0/200</span>
        </div>
        <div>
          Descreva as cores ou compartilhe os códigos HEX. Exemplo: Azul
          #0000FF, Branco #FFFFFF
        </div>
      </div>

      <div>
        <label for="estilo">Tem alguma referência visual ou estilo que gostaria de
          seguir?</label>
        <div class="input-container">
          <input type="text" id="estilo" name="estilo" class="neon" maxlength="200" />
          <span class="char-counter" id="estilo-counter">0/200</span>
        </div>
        <div>
          Minimalista, vibrante, vintage, futurista, etc.
        </div>
      </div>

      <div>
        <label>Precisa de sugestões para identidade visual?</label>
        <div>
          <input type="radio" id="sim" name="sugestoes" value="sim" class="neon" />
          <label for="sim">Sim, quero opções</label>
          <input type="radio" id="nao" name="sugestoes" value="nao" class="neon" />
          <label for="nao">Não preciso, já tenho</label>
        </div>
      </div>

      <div>
        <label for="descricao">Descreva brevemente o que sua empresa/produto faz</label>
        <div class="input-container">
          <textarea id="descricao" name="descricao" class="neon" maxlength="500"></textarea>
          <span class="char-counter" id="descricao-counter">0/500</span>
        </div>
        <div>
          Exemplo: Oferecemos soluções de automação para pequenas empresas
        </div>
      </div>

      <div>
        <label for="ideia">Qual é o seu negócio ou a ideia dele?</label>
        <div class="input-container">
          <textarea id="ideia" name="ideia" class="neon" maxlength="500"></textarea>
          <span class="char-counter" id="ideia-counter">0/500</span>
        </div>
        <div>Explique em poucas palavras</div>
      </div>

      <div>
        <label for="solucao">Qual a principal solução do seu produto/serviço?</label>
        <div class="input-container">
          <textarea id="solucao" name="solucao" class="neon" maxlength="500"></textarea>
          <span class="char-counter" id="solucao-counter">0/500</span>
        </div>
        <div>
          Exemplo: Automatiza processos para economizar tempo
        </div>
      </div>

      <div>
        <label for="entrega">Como é a entrega do seu produto/serviço?</label>
        <div class="input-container">
          <textarea id="entrega" name="entrega" class="neon" maxlength="500"></textarea>
          <span class="char-counter" id="entrega-counter">0/500</span>
        </div>
        <div>
          Exemplo: Venda online, licença SaaS, assinatura mensal
        </div>
      </div>

      <div>
        <label for="receita">Quais são suas principais fontes de receita?</label>
        <div class="input-container">
          <textarea id="receita" name="receita" class="neon" maxlength="500"></textarea>
          <span class="char-counter" id="receita-counter">0/500</span>
        </div>
        <div>Exemplo: Venda direta, Assinatura, Publicidade</div>
      </div>

      <div>
        <label for="parceiros">Quem são seus principais parceiros?</label>
        <div class="input-container">
          <textarea id="parceiros" name="parceiros" class="neon" maxlength="500"></textarea>
          <span class="char-counter" id="parceiros-counter">0/500</span>
        </div>
        <div>Exemplo: Fornecedores, investidores, afiliados</div>
      </div>

      <div>
        <label for="publico">Quem são seus públicos-alvo e avatares?</label>
        <div class="input-container">
          <textarea id="publico" name="publico" class="neon" maxlength="500"></textarea>
          <span class="char-counter" id="publico-counter">0/500</span>
        </div>
        <div>
          Exemplo: Mães de 30 a 40 anos autônomas que precisam conciliar
          trabalho profissional e maternidade dentro de casa
        </div>
      </div>

      <div>
        <label for="vendas">Como faz as vendas?</label>
        <div class="input-container">
          <textarea id="vendas" name="vendas" class="neon" maxlength="500"></textarea>
          <span class="char-counter" id="vendas-counter">0/500</span>
        </div>
        <div>
          B2B, B2C, Marketplace, Vendas diretas, Inbound, Outbound,
          Autoatendimento
        </div>
      </div>

      <div>
        <label for="relacionamento">Como você se relaciona com os clientes?</label>
        <div class="input-container">
          <textarea id="relacionamento" name="relacionamento" class="neon" maxlength="500"></textarea>
          <span class="char-counter" id="relacionamento-counter">0/500</span>
        </div>
        <div>
          Exemplo: Atendimento personalizado, suporte automatizado, comunidade
          online
        </div>
      </div>

      <div>
        <label for="valores">Quais são seus valores?</label>
        <div class="input-container">
          <textarea id="valores" name="valores" class="neon" maxlength="500"></textarea>
          <span class="char-counter" id="valores-counter">0/500</span>
        </div>
        <div>Exemplo: Inovação, transparência, humanização</div>
      </div>

      <div>
        <label for="crenca">No que você acredita?</label>
        <div class="input-container">
          <textarea id="crenca" name="crenca" class="neon" maxlength="500"></textarea>
          <span class="char-counter" id="crenca-counter">0/500</span>
        </div>
        <div>Exemplo: Transformar ideias em resultados</div>
      </div>

      <div>
        <label for="objetivo">Qual é o seu objetivo / propósito?</label>
        <div class="input-container"></div>
          <textarea id="objetivo" name="objetivo" class="neon" maxlength="500"></textarea>
          <span class="char-counter" id="objetivo-counter">0/500</span>
        </div>
        <div>
          Exemplo: Democratizar o acesso à tecnologia para pequenos negócios
        </div>
      </div>

      <div>
        <label for="crencas_clientes">No que seus clientes em potencial acreditam?</label>
        <div class="input-container">
          <textarea id="crencas_clientes" name="crencas_clientes" class="neon" maxlength="500"></textarea>
          <span class="char-counter" id="crencas_clientes-counter">0/500</span>
        </div>
        <div>
          Exemplo: Mudar de vida, ganhar dinheiro fácil, ter uma vida
          abundante
        </div>
      </div>

      <div>
        <label for="gostos_clientes">Do que seus clientes em potencial gostam?</label>
        <div class="input-container">
          <textarea id="gostos_clientes" name="gostos_clientes" class="neon" maxlength="500"></textarea>
          <span class="char-counter" id="gostos_clientes-counter">0/500</span>
        </div>
        <div>
          Exemplo: Praticidade, Carro, Viagem, Tecnologia
        </div>
      </div>

      <div>
        <label for="venda_indireta">O que você vende sem dizer o que você vende?</label>
        <div class="input-container">
          <textarea id="venda_indireta" name="venda_indireta" class="neon" maxlength="500"></textarea>
          <span class="char-counter" id="venda_indireta-counter">0/500</span>
        </div>
      </div>

      <div>
        <label>Qual é o seu modelo de negócio?</label>
        <div>
          <input type="radio" id="venda_direta" name="modelo_negocio" value="venda_direta" class="neon" />
          <label for="venda_direta">Venda Direta</label>
          <input type="radio" id="assinatura" name="modelo_negocio" value="assinatura" class="neon" />
          <label for="assinatura">Assinatura</label>
          <input type="radio" id="marketplace" name="modelo_negocio" value="marketplace" class="neon" />
          <label for="marketplace">Marketplace</label>
          <input type="radio" id="freemium" name="modelo_negocio" value="freemium" class="neon" />
          <label for="freemium">Freemium</label>
        </div>
      </div>

      <div>
        <label for="canais">Quais canais você usa para gerar leads e vendas?</label>
        <textarea id="canais" name="canais" class="neon" maxlength="500"></textarea>
        <small class="char-counter" id="canais-counter">0/500</small>
        <div>
          Exemplo: E-commerce, E-mail, LinkedIn, Telefone, Whatsapp, Eventos
        </div>
      </div>

      <div>
        <label for="estrategia_digital">Você já tem uma estratégia de presença digital ou quer começar do
          zero?</label>
        <textarea id="estrategia_digital" name="estrategia_digital" class="neon" maxlength="500"></textarea>
        <small class="char-counter" id="estrategia_digital-counter">0/500</small>
      </div>

      <div>
        <label for="diferencial">O que torna seu negócio diferente dos concorrentes?</label>
        <textarea id="diferencial" name="diferencial" class="neon" maxlength="500"></textarea>
        <small class="char-counter" id="diferencial-counter">0/500</small>
      </div>

      <div>
        <label for="concorrentes">Quem são seus principais concorrentes ou referências no
          mercado?</label>
        <textarea id="concorrentes" name="concorrentes" class="neon" maxlength="500"></textarea>
        <small class="char-counter" id="concorrentes-counter">0/500</small>
      </div>

      <div>
        <label for="concorrentes_melhor">O que acha que seus concorrentes estão fazendo melhor do que
          você?</label>
        <textarea id="concorrentes_melhor" name="concorrentes_melhor" class="neon" maxlength="500"></textarea>
        <small class="char-counter" id="concorrentes_melhor-counter">0/500</small>
      </div>

      <div>
        <label for="desafios">Quais são seus principais desafios e oportunidades?</label>
        <textarea id="desafios" name="desafios" class="neon" maxlength="500"></textarea>
        <small class="char-counter" id="desafios-counter">0/500</small>
      </div>

      <div>
        <label>Os clientes têm muitas opções de compra?</label><br />
        <div>
          <input type="radio" id="opcoes_sim" name="opcoes_compra" value="sim" class="neon" />
          <label for="opcoes_sim">Sim</label>
          <input type="radio" id="opcoes_nao" name="opcoes_compra" value="nao" class="neon" />
          <label for="opcoes_nao">Não</label>
        </div>
      </div>

      <div>
        <label for="ciclo_vendas">Qual é o tempo médio do seu ciclo de vendas, do primeiro contato
          até o fechamento?</label>
        <input type="text" id="ciclo_vendas" name="ciclo_vendas" class="neon" maxlength="200" />
        <small class="char-counter" id="ciclo_vendas-counter">0/200</small>
      </div>

      <div>
        <label for="gargalo">Há algum gargalo específico no processo de vendas que você gostaria
          de resolver?</label>
        <input type="text" id="gargalo" name="gargalo" class="neon" maxlength="200" />
        <small class="char-counter" id="gargalo-counter">0/200</small>
        <div>
          Ex: baixa taxa de conversão, aumentar o ticket médio, etc
        </div>
      </div>

      <div>
        <label for="descoberta">Como um cliente descobre seu negócio hoje?</label>
        <textarea id="descoberta" name="descoberta" class="neon" maxlength="500"></textarea>
        <small class="char-counter" id="descoberta-counter">0/500</small>
        <div>Exemplo: Indicações, redes sociais, anúncios</div>
      </div>

      <div>
        <label for="jornada">Quais passos um cliente percorre até comprar algo de você?</label>
        <textarea id="jornada" name="jornada" class="neon" maxlength="500"></textarea>
        <small class="char-counter" id="jornada-counter">0/500</small>
      </div>

      <div>
        <label for="melhorias">Onde você acha que pode melhorar essa experiência da jornada do seu
          cliente?</label>
        <textarea id="melhorias" name="melhorias" class="neon" maxlength="500"></textarea>
        <small class="char-counter" id="melhorias-counter">0/500</small>
      </div>

      <div>
        <label for="produtos">Quais produtos ou serviços sua marca oferece?</label>
        <textarea id="produtos" name="produtos" class="neon" maxlength="500"></textarea>
        <small class="char-counter" id="produtos-counter">0/500</small>
      </div>

      <div>
        <label for="diferenciais">A empresa tem diferenciais fortes que fidelizam clientes? Se sim,
          quais?</label>
        <textarea id="diferenciais" name="diferenciais" class="neon" maxlength="500"></textarea>
        <small class="char-counter" id="diferenciais-counter">0/500</small>
      </div>

      <div>
        <label for="tendencias">Quais são as tendências de mercado que podem impactar seu
          setor?</label>
        <textarea id="tendencias" name="tendencias" class="neon" maxlength="500"></textarea>
        <small class="char-counter" id="tendencias-counter">0/500</small>
      </div>

      <div>
        <label for="descricao_curta">Descreva o que sua marca faz em poucas palavras</label>
        <textarea id="descricao_curta" name="descricao_curta" class="neon" maxlength="200"></textarea>
        <small class="char-counter" id="descricao_curta-counter">0/200</small>
      </div>

      <div>
        <label for="palavras_associadas">Quais palavras você gostaria que fossem associadas à sua
          marca?</label>
        <textarea id="palavras_associadas" name="palavras_associadas" class="neon" maxlength="200"></textarea>
        <small class="char-counter" id="palavras_associadas-counter">0/200</small>
        <div>
          Exemplo: Inovação, sofisticação, acessibilidade
        </div>
      </div>

      <div>
        <label for="conteudo">Que tipo de conteúdo você já produz (se já produz)?</label>
        <textarea id="conteudo" name="conteudo" class="neon" maxlength="500"></textarea>
        <small class="char-counter" id="conteudo-counter">0/500</small>
      </div>

      <div>
        <label for="temas">Que temas gostaria de abordar?</label>
        <textarea id="temas" name="temas" class="neon" maxlength="500"></textarea>
        <small class="char-counter" id="temas-counter">0/500</small>
        <div>Exemplo: Educação, vendas, entretenimento</div>
      </div>

      <div>
        <label for="produtos_definidos">Você já tem produtos ou serviços definidos ou deseja ajuda para
          criar novas ofertas?</label>
        <textarea id="produtos_definidos" name="produtos_definidos" class="neon" maxlength="500"></textarea>
        <small class="char-counter" id="produtos_definidos-counter">0/500</small>
      </div>
      <center>
        <button type="submit">Enviar Formulário</button>
      </center>
    </form>
  </main>

  <!-- Footer Section -->
  <script src="/assets/scripts/footer.js"></script>



  <script type="module">
  import { supabase } from '/src/supabase.js';

    // Função para gerar UUID
    function generateUUID() {
      return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
        const r = Math.random() * 16 | 0, v = c === 'x' ? r : (r & 0x3 | 0x8);
        return v.toString(16);
      });
    }
    
    // Registrar função de envio do formulário quando o documento estiver carregado
    document.addEventListener('DOMContentLoaded', function() {
      console.log("Documento carregado, inicializando formulário...");
      
      // Capturar o formulário
      const form = document.getElementById('businessForm');
      console.log("Formulário encontrado:", !!form);
      
      // Adicionar event listener para submit
      if (form) {
        form.addEventListener('submit', async function(event) {
          event.preventDefault();
          console.log("Formulário enviado, iniciando processamento...");
          
          // Mostrar alerta de processamento
          showAlert('Enviando formulário...', 'info');
          
          // Coletar dados do formulário
          const formData = new FormData(form);
          
          // Definir a variável temLogotipo
          const temLogotipo = document.querySelector('input[name="tem_logotipo"]:checked')?.value;

          // Verificar se o campo "tem_logotipo" foi selecionado
          if (!temLogotipo) {
            showAlert('Por favor, selecione se sua marca possui um logotipo (Sim ou Não).', 'error');
            return; // Interrompe o envio do formulário
          }

          // Coletar os valores dos checkboxes de modelo de negócio
          const modeloNegocio = document.querySelector('input[name="modelo_negocio"]:checked')?.value || null;
       
          
          let logotipoUrl = null;

          if (temLogotipo === 'sim') {
            const logotipoFile = formData.get('logotipo');
            
            // Verificar se o arquivo foi enviado
            if (!logotipoFile || logotipoFile.size === 0) {
              console.log("Arquivo de logotipo não enviado ou vazio.");
              showAlert('Por favor, envie um arquivo de logotipo antes de continuar.', 'error');
              return; // Interrompe o processamento do formulário
            }
          
            // Verificar se o arquivo é uma imagem
            const validImageTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/webp'];
            if (!validImageTypes.includes(logotipoFile.type.toLowerCase())) {
              showAlert('Por favor, envie um arquivo de imagem válido (JPEG, JPG, PNG, GIF, WEBP).', 'error');
              return; // Interrompe o processamento do formulário
            }
          
            try {
              // Gerar um nome de arquivo único usando UUID
              const uniqueFileName = `${generateUUID()}-${logotipoFile.name}`;
              
              const { data: uploadData, error: uploadError } = await supabase.storage
                .from('logotipos')
                .upload(`public/${uniqueFileName}`, logotipoFile);
          
              if (uploadError) {
                throw uploadError;
              }
          
              // Obter a URL pública da imagem
              const { data: publicURLData, error: publicUrlError } = supabase.storage
                .from('logotipos')
                .getPublicUrl(`public/${uniqueFileName}`);
          
              if (publicUrlError) {
                throw publicUrlError;
              }
          
              logotipoUrl = publicURLData.publicUrl;
            } catch (error) {
              console.error('Erro ao fazer upload do logotipo:', error);
              showAlert(`Erro ao fazer upload do logotipo: ${error.message || "Erro desconhecido"}. Por favor, tente novamente.`, 'error');
              return; // Interrompe o processamento do formulário
            }
          }
          
          // Criar objeto de dados
          let data = {
            empresa: formData.get('empresa'),
            setor: formData.get('setor'),
            nicho: formData.get('nicho'),
            departamento: formData.get('departamento'),
            localizacao: formData.get('localizacao'),
            marca: formData.get('marca'),
            slogan: formData.get('slogan'),
            fundadores: formData.get('fundadores'),
            fundacao: formData.get('fundacao'),
            estagio: formData.get('estagio'),
            sede: formData.get('sede'),
            site: formData.get('site'),
            redes_sociais: formData.get('redes'),
            logotipo: logotipoUrl, // Adicionar URL do logotipo
            cores: formData.get('cores'),
            estilo_visual: formData.get('estilo'),
            sugestoes_identidade: formData.get('sugestoes'),
            descricao: formData.get('descricao'),
            ideia: formData.get('ideia'),
            solucao: formData.get('solucao'),
            entrega: formData.get('entrega'),
            receita: formData.get('receita'),
            parceiros: formData.get('parceiros'),
            publico_alvo: formData.get('publico'),
            vendas: formData.get('vendas'),
            relacionamento_clientes: formData.get('relacionamento'),
            valores: formData.get('valores'),
            crenca: formData.get('crenca'),
            objetivo: formData.get('objetivo'),
            crencas_clientes: formData.get('crencas_clientes'),
            gostos_clientes: formData.get('gostos_clientes'),
            venda_indireta: formData.get('venda_indireta'),
            modelo_negocio: formData.get('modelo_negocio'),
            canais: formData.get('canais'),
            estrategia_digital: formData.get('estrategia_digital'),
            diferencial: formData.get('diferencial'),
            concorrentes: formData.get('concorrentes'),
            concorrentes_melhor: formData.get('concorrentes_melhor'),
            desafios: formData.get('desafios'),
            opcoes_compra: formData.get('opcoes_compra'),
            ciclo_vendas: formData.get('ciclo_vendas'),
            gargalo: formData.get('gargalo'),
            descoberta: formData.get('descoberta'),
            jornada: formData.get('jornada'),
            melhorias: formData.get('melhorias'),
            produtos: formData.get('produtos'),
            diferenciais: formData.get('diferenciais'),
            tendencias: formData.get('tendencias'),
            descricao_curta: formData.get('descricao_curta'),
            palavras_associadas: formData.get('palavras_associadas'),
            conteudo: formData.get('conteudo'),
            temas: formData.get('temas'),
            produtos_definidos: formData.get('produtos_definidos')
          };
          
          // Substituir valores vazios por null
          data = replaceEmptyWithNull(data);

          console.log("Dados preparados:", data);
          
          try {
            console.log("Iniciando inserção no Supabase...");
            
            // Enviar dados para o Supabase
            const { data: result, error } = await supabase
              .from('business_form')
              .insert([data]);
            
            console.log("Resposta do Supabase:", { result, error });
            
            if (error) {
              throw error;
            }
            
            showAlert('Formulário enviado com sucesso!', 'success');
            form.reset();
          } catch (error) {
            console.error('Erro completo:', error);
            showAlert(
              `Erro ao enviar formulário: ${error.message || "Erro desconhecido"}. Por favor, tente novamente.`,
              'error'
            );
          }
        });
      }
    });
    
    // Função para mostrar alertas
    function showAlert(message, type) {
      const alert = document.getElementById('alert');
      if (!alert) {
        console.error("Elemento de alerta não encontrado!");
        return;
      }

      // Configurar o texto e a classe do alerta
      alert.textContent = message;
      alert.className = `alert alert-${type}`; // Define a classe com base no tipo (ex: 'alert-error')
      alert.style.display = 'block'; // Garante que o alerta seja exibido
      alert.classList.remove('hidden'); // Remove a classe 'hidden', se existir

      // Ocultar o alerta após 5 segundos
      setTimeout(() => {
        alert.style.display = 'none';
        alert.classList.add('hidden'); // Adiciona a classe 'hidden' novamente
      }, 5000);
    }

    const temLogotipoCheckbox = document.getElementById('tem_logotipo');

    if (temLogotipoCheckbox) {
      temLogotipoCheckbox.addEventListener('change', function () {
        if (temLogotipoCheckbox.checked) {
          logotipoUploadDiv.style.display = 'block'; // Mostrar campo de upload
        } else {
          logotipoUploadDiv.style.display = 'none'; // Ocultar campo de upload
        }
      });
    }

    // Função para substituir valores vazios por null
    function replaceEmptyWithNull(obj) {
      for (const key in obj) {
        if (obj[key] === '') {
          obj[key] = null;
        }
      }
      return obj;
    }

    const logotipoSim = document.getElementById('tem_logotipo_sim');
    const logotipoNao = document.getElementById('tem_logotipo_nao');
    const logotipoUploadDiv = document.getElementById('logotipo_upload');

    if (logotipoSim && logotipoNao) {
      logotipoSim.addEventListener('change', function () {
        if (logotipoSim.checked) {
          logotipoUploadDiv.style.display = 'block'; // Mostrar campo de upload
        }
      });

      logotipoNao.addEventListener('change', function () {
        if (logotipoNao.checked) {
          logotipoUploadDiv.style.display = 'none'; // Ocultar campo de upload
        }
      });
    }

    // Função para atualizar contadores de caracteres
    document.addEventListener('DOMContentLoaded', function () {
      const inputs = document.querySelectorAll('input[type="text"], textarea');
      inputs.forEach(input => {
        const counter = document.getElementById(`${input.id}-counter`);
        if (counter) {
          input.addEventListener('input', () => {
            counter.textContent = `${input.value.length}/${input.maxLength}`;
          });
        }
      });
    });

    document.addEventListener('DOMContentLoaded', function () {
      const form = document.getElementById('businessForm');
      const submitButton = form.querySelector('button[type="submit"]');
      let confirmationCheckbox;

      if (form) {
        const inputs = form.querySelectorAll('input, textarea, select');

        // Função para verificar campos vazios
        function validateFields() {
          const emptyFields = [];
          inputs.forEach((input) => {
            const errorMessage = input.nextElementSibling;
            if (!input.value.trim() && input.type !== 'file') {
              emptyFields.push(input);
              if (!errorMessage || !errorMessage.classList.contains('error-message')) {
                const errorDiv = document.createElement('div');
                errorDiv.className = 'error-message';
                errorDiv.style.color = 'red';
                errorDiv.style.fontSize = '12px';
                errorDiv.textContent = 'Este campo está vazio.';
                input.insertAdjacentElement('afterend', errorDiv);
              }
            } else if (errorMessage && errorMessage.classList.contains('error-message')) {
              errorMessage.remove(); // Remove o alerta se o campo for preenchido
            }
          });
          return emptyFields;
        }

        // Função para criar checkbox de confirmação
        function createConfirmationCheckbox() {
          // Sempre recria a checkbox para garantir que ela seja validada novamente
          if (document.getElementById('confirm-empty-fields')) {
            document.getElementById('confirm-empty-fields').parentElement.remove();
          }

          const checkboxContainer = document.createElement('div');
          checkboxContainer.style.marginTop = '20px';

          confirmationCheckbox = document.createElement('input');
          confirmationCheckbox.type = 'checkbox';
          confirmationCheckbox.id = 'confirm-empty-fields';
          confirmationCheckbox.name = 'confirm-empty-fields';

          const checkboxLabel = document.createElement('label');
          checkboxLabel.htmlFor = 'confirm-empty-fields';
          checkboxLabel.style.marginLeft = '5px';
          checkboxLabel.textContent = 'Você confirma que deseja enviar o formulário com campos vazios?';

          checkboxContainer.appendChild(confirmationCheckbox);
          checkboxContainer.appendChild(checkboxLabel);

          submitButton.insertAdjacentElement('beforebegin', checkboxContainer);

          // Desativar botão "Enviar" até que a checkbox seja marcada
          submitButton.disabled = true;
          confirmationCheckbox.addEventListener('change', () => {
            submitButton.disabled = !confirmationCheckbox.checked;
          });
        }

        // Função para validar o formulário em tempo real
        function validateForm() {
          const emptyFields = validateFields();

          if (emptyFields.length > 0) {
            createConfirmationCheckbox();
          } else {
            if (confirmationCheckbox) {
              confirmationCheckbox.parentElement.remove(); // Remover checkbox
            }
            submitButton.disabled = false; // Ativar botão "Enviar"
          }
        }

        // Adicionar validação em tempo real
        inputs.forEach((input) => {
          input.addEventListener('input', validateForm);
        });

        // Adicionar validação no envio do formulário
        form.addEventListener('submit', function (event) {
          const emptyFields = validateFields();

          if (emptyFields.length > 0) {
            if (!confirmationCheckbox || !confirmationCheckbox.checked) {
              event.preventDefault(); // Impedir envio se a checkbox não estiver marcada
              createConfirmationCheckbox(); // Garantir que a checkbox seja recriada
              return;
            }
          }

          // Permitir o envio do formulário
          console.log('Formulário enviado com sucesso!');
          form.reset(); // Reseta o formulário após o envio
          confirmationCheckbox = null; // Reseta a checkbox para garantir que ela seja recriada na próxima tentativa
        });
      }
    });
  </script>
</body>

</html>

